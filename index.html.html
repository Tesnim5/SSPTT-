<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salle De Sport Pour Tous - Gestion des membres</title>

  <!-- Flatpickr styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
      color: #222;
      padding: 20px 30px;
      box-shadow: 0 0 15px rgba(25, 118, 210, 0.1);
      border-radius: 12px;
    }
    h1 {
      text-align: center;
      color: #1565c0;
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 30px;
      text-shadow: 1px 1px 3px rgba(21, 101, 192, 0.3);
    }
    nav button {
      display: block;
      width: 100%;
      margin: 14px 0;
      padding: 16px 0;
      font-size: 1.3em;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 6px 10px rgba(25, 118, 210, 0.3);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    nav button:hover {
      background-color: #0d47a1;
      box-shadow: 0 8px 14px rgba(13, 71, 161, 0.5);
    }
    .back-link {
      display: inline-block;
      margin: 20px 0;
      text-decoration: none;
      color: #1976d2;
      font-weight: 600;
      cursor: pointer;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #1976d2;
      color: white;
    }
    input.text-input {
      width: 95%;
      padding: 5px;
      font-size: 1em;
      border: 1px solid #aaa;
      border-radius: 4px;
    }

    /* Vue mois paiement */
    .mois-view {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 8px;
      background: #fff;
      display: none;
    }
    .mois-view h3 {
      margin-bottom: 10px;
    }
    .mois-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    .mois-item {
      padding: 8px;
      border-radius: 6px;
      font-weight: bold;
      text-align: center;
      background: #eee;
      cursor: pointer;
      user-select: none;
      position: relative;
      min-height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .paye { background-color: #c8e6c9; color: green; }
    .non-paye { background-color: #ffcdd2; color: #b71c1c; }

    /* Tooltip date paiement */
    .tooltip-date {
      font-size: 0.85em;
      color: #555;
      margin-top: 4px;
    }

    /* Sélecteur année */
    #yearSelector {
      margin-bottom: 15px;
      font-size: 1.1em;
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid #aaa;
    }
  </style>
</head>
<body>

<div id="page-principale">
  <h1>Salle De Sport Pour Tous</h1>
  <nav>
    <button data-sport="karate">Karaté</button>
    <button data-sport="aerobic_hommes">Aérobic Hommes</button>
    <button data-sport="aerobic_femmes">Aérobic Femmes</button>
    <button data-sport="boxe">Boxe</button>
    <button data-sport="musculation">Musculation</button>
  </nav>
</div>

<!-- Pages sports -->
<div class="sport-page" id="karate" style="display:none;">
  <h1>Karaté - Gestion des membres</h1>
  <table id="table-karate"><thead><tr><th>Nom</th><th>Prénom</th></tr></thead><tbody></tbody></table>
  <button class="add-row">➕ Ajouter un membre</button><br />
  <a class="back-link">← Retour à la page principale</a>
</div>

<div class="sport-page" id="aerobic_hommes" style="display:none;">
  <h1>Aérobic Hommes - Gestion des membres</h1>
  <table id="table-aerobic_hommes"><thead><tr><th>Nom</th><th>Prénom</th></tr></thead><tbody></tbody></table>
  <button class="add-row">➕ Ajouter un membre</button><br />
  <a class="back-link">← Retour à la page principale</a>
</div>

<div class="sport-page" id="aerobic_femmes" style="display:none;">
  <h1>Aérobic Femmes - Gestion des membres</h1>
  <table id="table-aerobic_femmes"><thead><tr><th>Nom</th><th>Prénom</th></tr></thead><tbody></tbody></table>
  <button class="add-row">➕ Ajouter un membre</button><br />
  <a class="back-link">← Retour à la page principale</a>
</div>

<div class="sport-page" id="boxe" style="display:none;">
  <h1>Boxe - Gestion des membres</h1>
  <table id="table-boxe"><thead><tr><th>Nom</th><th>Prénom</th></tr></thead><tbody></tbody></table>
  <button class="add-row">➕ Ajouter un membre</button><br />
  <a class="back-link">← Retour à la page principale</a>
</div>

<div class="sport-page" id="musculation" style="display:none;">
  <h1>Musculation - Gestion des membres</h1>
  <table id="table-musculation"><thead><tr><th>Nom</th><th>Prénom</th></tr></thead><tbody></tbody></table>
  <button class="add-row">➕ Ajouter un membre</button><br />
  <a class="back-link">← Retour à la page principale</a>
</div>

<!-- Vue détails paiement mois -->
<div id="moisDetails" class="mois-view">
  <h3 id="nomMembre">Paiements de : </h3>
  
  <label for="yearSelector">Année :</label>
  <select id="yearSelector"></select>
  
  <div class="mois-grid" id="gridMois"></div>
  <button id="closeMoisDetails" style="margin-top:10px; padding:5px 10px; cursor:pointer;">Fermer</button>
</div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>

<script>
  const pagePrincipale = document.getElementById('page-principale');
  const sportPages = document.querySelectorAll('.sport-page');
  const moisDetails = document.getElementById("moisDetails");
  const nomMembre = document.getElementById("nomMembre");
  const gridMois = document.getElementById("gridMois");
  const closeMoisDetails = document.getElementById("closeMoisDetails");
  const yearSelector = document.getElementById("yearSelector");

  const mois = ["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];

  // Stockage paiements : sport -> membre -> année -> mois -> date
  const paiements = {};

  let currentSport, currentMemberIndex, currentNom, currentPrenom;
  let currentYear;

  function cacherTous() {
    pagePrincipale.style.display = 'none';
    sportPages.forEach(p => p.style.display = 'none');
    moisDetails.style.display = 'none';
  }

  function afficherSport(sportId) {
    cacherTous();
    document.getElementById(sportId).style.display = 'block';
  }

  // Fonction remplissage années sans limite haute fixe
  function remplirYearsSelect(selectedYear) {
    yearSelector.innerHTML = "";

    const startYear = 2000;  // année de départ
    const thisYear = new Date().getFullYear();
    const endYear = thisYear + 100;  // 100 ans dans le futur

    for(let y = startYear; y <= endYear; y++) {
      const option = document.createElement("option");
      option.value = y;
      option.textContent = y;
      if(y === selectedYear) option.selected = true;
      yearSelector.appendChild(option);
    }
  }

  // Affiche mois paiement pour l'année choisie
  function afficherMoisPaiement(sportId, rowIndex, nom, prenom, year) {
    currentSport = sportId;
    currentMemberIndex = rowIndex;
    currentNom = nom;
    currentPrenom = prenom;
    currentYear = year;

    nomMembre.textContent = `Paiements de : ${prenom} ${nom} — Année ${year}`;
    gridMois.innerHTML = "";

    if(!paiements[sportId]) paiements[sportId] = {};
    if(!paiements[sportId][rowIndex]) paiements[sportId][rowIndex] = {};
    if(!paiements[sportId][rowIndex][year]) {
      paiements[sportId][rowIndex][year] = {};
      for(let i=1; i<=12; i++) {
        const m = i.toString().padStart(2,'0');
        paiements[sportId][rowIndex][year][m] = null;
      }
    }

    const paiementsMembreAnnee = paiements[sportId][rowIndex][year];

    for(let i=1; i<=12; i++) {
      const m = i.toString().padStart(2,'0');
      const datePayement = paiementsMembreAnnee[m];

      const div = document.createElement("div");
      div.className = "mois-item " + (datePayement ? "paye" : "non-paye");
      div.dataset.mois = m;
      div.textContent = mois[i-1];

      if(datePayement) {
        const dateDiv = document.createElement("div");
        dateDiv.className = "tooltip-date";
        dateDiv.textContent = datePayement;
        div.appendChild(dateDiv);
      }

      div.addEventListener('click', () => {
        if(div.querySelector('input')) return;

        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'text-input';
        div.innerHTML = '';
        div.appendChild(input);
        input.focus();

        flatpickr(input, {
          locale: "fr",
          dateFormat: "d/m/Y",
          defaultDate: datePayement || null,
          onClose: function(selectedDates, dateStr) {
            if(dateStr) {
              paiements[sportId][rowIndex][year][m] = dateStr;
            } else {
              paiements[sportId][rowIndex][year][m] = null;
            }
            // Recharger affichage mois
            afficherMoisPaiement(sportId, rowIndex, nom, prenom, year);
          },
          clickOpens: true,
          allowInput: true,
        });
      });

      gridMois.appendChild(div);
    }

    moisDetails.style.display = "block";
  }

  yearSelector.addEventListener('change', () => {
    if(currentSport !== undefined && currentMemberIndex !== undefined) {
      afficherMoisPaiement(currentSport, currentMemberIndex, currentNom, currentPrenom, parseInt(yearSelector.value));
    }
  });

  closeMoisDetails.addEventListener('click', () => {
    moisDetails.style.display = "none";
  });

  document.querySelectorAll('#page-principale nav button').forEach(btn => {
    btn.addEventListener('click', () => {
      afficherSport(btn.getAttribute('data-sport'));
    });
  });

  document.querySelectorAll('.sport-page .back-link').forEach(link => {
    link.addEventListener('click', () => {
      cacherTous();
      pagePrincipale.style.display = 'block';
    });
  });

  function ajouterLigne(tableBody, sportId) {
    const newRow = document.createElement('tr');

    const tdNom = document.createElement('td');
    const inputNom = document.createElement('input');
    inputNom.type = 'text';
    inputNom.className = 'text-input';
    inputNom.placeholder = 'Nom';
    tdNom.appendChild(inputNom);

    const tdPrenom = document.createElement('td');
    const inputPrenom = document.createElement('input');
    inputPrenom.type = 'text';
    inputPrenom.className = 'text-input';
    inputPrenom.placeholder = 'Prénom';
    tdPrenom.appendChild(inputPrenom);

    newRow.appendChild(tdNom);
    newRow.appendChild(tdPrenom);

    tableBody.appendChild(newRow);

    const rowIndex = [...tableBody.children].indexOf(newRow);

    if (!paiements[sportId]) paiements[sportId] = {};
    if (!paiements[sportId][rowIndex]) paiements[sportId][rowIndex] = {};

    newRow.addEventListener('click', () => {
      const nom = inputNom.value.trim() || "Inconnu";
      const prenom = inputPrenom.value.trim() || "";
      const thisYear = new Date().getFullYear();
      remplirYearsSelect(thisYear);
      afficherMoisPaiement(sportId, rowIndex, nom, prenom, thisYear);
    });
  }

  ['karate', 'aerobic_hommes', 'aerobic_femmes', 'boxe', 'musculation'].forEach(sportId => {
    const tableBody = document.querySelector(`#table-${sportId} tbody`);
    const addBtn = document.querySelector(`#${sportId} .add-row`);

    ajouterLigne(tableBody, sportId);

    addBtn.addEventListener('click', () => ajouterLigne(tableBody, sportId));
  });
</script>

</body>
</html>
